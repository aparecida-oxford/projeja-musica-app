<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Slides de Letras - Sequ√™ncia de M√∫sicas</title>
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:#1e1f29; color:#f0f0f0; }
.container { max-width:1200px; margin:0 auto; padding:30px; }
h2 { text-align:center; margin-bottom:20px; color:#5b8cff; }
.section { background:#2b2d42; padding:20px; margin-bottom:20px; border-radius:10px; }
.section h3 { color:#5b8cff; margin-top:0; border-bottom:2px solid #5b8cff; padding-bottom:10px; }
textarea { width:100%; height:120px; padding:12px; border-radius:10px; border:none; resize:vertical; background:#3e4062; color:#f0f0f0; font-size:16px; box-sizing:border-box; }
.options { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:20px; margin:20px 0; }
label { display:block; margin-bottom:5px; font-weight:600; }
input[type=color], input[type=number], select { width:100%; padding:8px; border-radius:8px; border:none; background:#3e4062; color:#f0f0f0; box-sizing:border-box; }
input[type=file] { width:100%; padding:8px; border-radius:8px; border:2px dashed #5b8cff; background:#3e4062; color:#f0f0f0; box-sizing:border-box; }
button { padding:12px 24px; margin-right:10px; margin-bottom:10px; border:none; border-radius:10px; cursor:pointer; background:#5b8cff; color:#fff; font-weight:bold; transition:0.3s; }
button:hover { background:#3a6ee8; }
button.secondary { background:#6c757d; }
button.secondary:hover { background:#545b62; }
button.danger { background:#e85b5b; }
button.danger:hover { background:#d63031; }
#preview { background:#3e4062; padding:15px; margin-top:20px; border-radius:10px; overflow:auto; }
.music-list { margin-top:20px; }
.music-item { padding:15px; margin-bottom:8px; background:#3e4062; border-radius:8px; display:flex; justify-content:space-between; align-items:center; cursor:grab; position:relative; }
.music-item.editing { background:#4a5568; }
.music-title { flex:1; margin-right:10px; word-break:break-word; }
.music-actions { display:flex; gap:10px; }
.remove-btn, .edit-btn { padding:6px 12px; border-radius:6px; font-weight:bold; cursor:pointer; font-size:12px; }
.remove-btn { background:#e85b5b; color:#fff; }
.edit-btn { background:#ffa500; color:#fff; }
.edit-form { margin-top:15px; padding:15px; background:#2b2d42; border-radius:8px; }
.edit-form textarea { height:200px; }
.progress { background:#2b2d42; border-radius:10px; margin-top:20px; padding:15px; }
.progress-bar { background:#5b8cff; height:8px; border-radius:4px; width:0%; transition:width 0.3s; }
.log { background:#2b2d42; border-radius:10px; margin-top:20px; padding:15px; max-height:300px; overflow-y:auto; }
.log-item { padding:5px 0; border-bottom:1px solid #333; font-size:14px; }
.log-warning { color:#ffa500; }
.log-error { color:#e85b5b; }
.log-success { color:#5baa47; }
.log-info { color:#17a2b8; }
.hidden { display: none; }
#textMeasure { position: absolute; left: -9999px; top: -9999px; white-space: pre-wrap; }
.import-section { border:2px dashed #5b8cff; padding:20px; text-align:center; }
.import-info { margin-bottom:15px; color:#adb5bd; }
.tabs { display:flex; margin-bottom:20px; border-bottom:2px solid #3e4062; }
.tab { padding:10px 20px; cursor:pointer; background:#3e4062; margin-right:5px; border-radius:8px 8px 0 0; color:#f0f0f0; }
.tab.active { background:#5b8cff; }
.tab-content { display:none; }
.tab-content.active { display:block; }
.slide-preview { background:#4a5568; padding:5px; margin:5px 0; border-radius:5px; font-size:12px; border-left:3px solid #5b8cff; }
.slide-preview-text { max-height:75px; overflow:hidden; }
.status-message { padding:10px; margin:10px 0; border-radius:5px; }
.status-success { background:#5baa47; color:#fff; }
.status-error { background:#e85b5b; color:#fff; }
.status-warning { background:#ffa500; color:#fff; }
</style>
</head>
<body>
<div class="container">
<h2>Gerador de Slides de Letras - Sequ√™ncia de M√∫sicas</h2>

<div class="tabs">
  <div class="tab active" onclick="switchTab('create')">Criar Novo</div>
  <div class="tab" onclick="switchTab('import')">Importar PPTX</div>
</div>

<div id="createTab" class="tab-content active">
  <div class="section">
    <h3>üéµ Adicionar Nova M√∫sica</h3>
    <textarea id="lyrics" placeholder="Cole a letra da m√∫sica aqui, com estrofes separadas por uma linha em branco..."></textarea>
    <button onclick="addMusic()">Adicionar M√∫sica √† Sequ√™ncia</button>
  </div>
</div>

<div id="importTab" class="tab-content">
  <div class="section">
    <h3>üìÇ Importar Apresenta√ß√£o Existente</h3>
    <div class="import-section">
      <div class="import-info">
        Selecione um arquivo PowerPoint (.pptx) para importar os slides existentes.<br>
        <strong>üîç Detec√ß√£o Autom√°tica:</strong> O sistema tentar√° identificar m√∫sicas separadas.<br>
        <strong>‚úèÔ∏è Edi√ß√£o Manual:</strong> Voc√™ sempre pode editar e separar as m√∫sicas depois.
      </div>
      <input type="file" id="importFile" accept=".pptx" onchange="importPPTX()">
      <div style="margin-top:15px; padding:10px; background:#3e4062; border-radius:5px; font-size:12px; color:#adb5bd;">
        <strong>üí° Para melhor separa√ß√£o autom√°tica:</strong><br>
        ‚Ä¢ Deixe slides vazios entre m√∫sicas diferentes<br>
        ‚Ä¢ Use numera√ß√£o clara: "M√∫sica 1:", "Hino 2 -"<br>
        ‚Ä¢ Use "T√≠tulo:" antes do nome da m√∫sica<br><br>
        <strong>‚ö†Ô∏è N√£o se preocupe:</strong> Mesmo que seja importado como uma m√∫sica s√≥, voc√™ pode editar e separar manualmente depois!
      </div>
    </div>
  </div>
</div>

<div class="section">
  <h3>‚öôÔ∏è Configura√ß√µes de Formata√ß√£o</h3>
  <div class="options">
    <div>
      <label>Cor do texto</label>
      <input type="color" id="textColor" value="#FFFFFF">
    </div>
    <div>
      <label>Cor de fundo do slide</label>
      <input type="color" id="bgColor" value="#000000">
    </div>
    <div>
      <label>Tamanho da fonte inicial</label>
      <input type="number" id="fontSize" value="47" min="12" max="72">
    </div>
    <div>
      <label>Tamanho m√≠nimo da fonte</label>
      <input type="number" id="minFontSize" value="24" min="12" max="48">
    </div>
    <div>
      <label>Tipo da Fonte</label>
      <select id="fontFamily">
        <option value="Arial">Arial</option>
        <option value="Calibri">Calibri</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Georgia">Georgia</option>
        <option value="Verdana">Verdana</option>
      </select>
    </div>
    <div>
      <label>Efeitos</label>
      <select id="fontEffects" multiple>
        <option value="bold">Negrito</option>
        <option value="italic">It√°lico</option>
      </select>
      <small style="display:block; color:#adb5bd; margin-top:5px;">(Segure Ctrl/Cmd para selecionar mais de um)</small>
    </div>
    <div>
      <label>Alinhamento</label>
      <select id="align">
        <option value="center">Centralizado</option>
        <option value="left">Esquerda</option>
        <option value="right">Direita</option>
        <option value="justify">Justificado</option>
      </select>
    </div>
    <div>
      <label>Layout</label>
      <select id="layout">
        <option value="LAYOUT_16x9">16:9</option>
        <option value="LAYOUT_4x3">4:3</option>
      </select>
    </div>
    <div>
      <label>Caixa de texto</label>
      <select id="caseOption">
        <option value="normal">Normal</option>
        <option value="upper">MAI√öSCULAS</option>
        <option value="lower">min√∫sculas</option>
      </select>
    </div>
    <div>
      <label>Quando texto n√£o couber</label>
      <select id="overflowOption">
        <option value="smart">Quebra inteligente + ajustes</option>
        <option value="shrink">Reduzir fonte</option>
        <option value="split">Dividir em slides</option>
        <option value="both">Tentar reduzir, se n√£o couber dividir</option>
      </select>
    </div>
  </div>
</div>

<div class="section">
  <h3>üéµ Sequ√™ncia de M√∫sicas</h3>
  <button onclick="generatePPTX()">üìä Gerar .pptx</button>
  <button class="secondary" onclick="previewSlides()">üëÅÔ∏è Visualizar Slides</button>
  <button class="danger" onclick="clearAll()">üóëÔ∏è Limpar Tudo</button>
  
  <div class="music-list" id="musicList"></div>
</div>

<div class="progress hidden" id="progress">
  <div>Processando slides...</div>
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="log hidden" id="log">
  <h3>üìã Log de Processamento:</h3>
  <div id="logContent"></div>
</div>

<div id="preview" class="hidden">
  <h3>üëÅÔ∏è Pr√©-visualiza√ß√£o dos Slides:</h3>
  <div id="previewContent"></div>
</div>

<div id="textMeasure"></div>

</div>

<script>
// Verifica√ß√£o inicial de depend√™ncias
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM carregado');
  
  // Verificar se as bibliotecas carregaram
  if (typeof PptxGenJS === 'undefined') {
    showStatusMessage('Erro: Biblioteca PptxGenJS n√£o carregou. Verifique sua conex√£o com a internet.', 'error');
    return;
  }
  
  if (typeof JSZip === 'undefined') {
    showStatusMessage('Erro: Biblioteca JSZip n√£o carregou. Verifique sua conex√£o com a internet.', 'error');
    return;
  }
  
  // Inicializar a interface
  renderMusicList();
  addLog('Sistema iniciado - Pronto para uso!', 'success');
  showStatusMessage('Sistema carregado com sucesso!', 'success');
});

let musicSequence = [];
let editingIndex = -1;

function showStatusMessage(message, type) {
  const container = document.querySelector('.container');
  const statusDiv = document.createElement('div');
  statusDiv.className = `status-message status-${type}`;
  statusDiv.textContent = message;
  
  container.insertBefore(statusDiv, container.firstChild);
  
  // Remover mensagem ap√≥s 5 segundos
  setTimeout(() => {
    if (statusDiv.parentNode) {
      statusDiv.parentNode.removeChild(statusDiv);
    }
  }, 5000);
}

function switchTab(tabName) {
  try {
    // Esconder todas as abas
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    
    // Mostrar aba selecionada
    document.getElementById(tabName + 'Tab').classList.add('active');
    event.target.classList.add('active');
  } catch (error) {
    console.error('Erro ao trocar aba:', error);
    addLog('Erro ao trocar aba: ' + error.message, 'error');
  }
}

function addMusic() {
  try {
    let text = document.getElementById("lyrics").value.trim();
    if (!text) return alert("Insira a letra da m√∫sica primeiro.");

    musicSequence.push(text);
    document.getElementById("lyrics").value = "";
    renderMusicList();
    addLog(`M√∫sica ${musicSequence.length} adicionada com sucesso`, 'success');
  } catch (error) {
    console.error('Erro ao adicionar m√∫sica:', error);
    addLog('Erro ao adicionar m√∫sica: ' + error.message, 'error');
  }
}

function editMusic(index) {
  try {
    if (editingIndex !== -1) {
      // Cancelar edi√ß√£o anterior
      cancelEdit();
    }
    
    editingIndex = index;
    renderMusicList();
  } catch (error) {
    console.error('Erro ao editar m√∫sica:', error);
    addLog('Erro ao editar m√∫sica: ' + error.message, 'error');
  }
}

function saveEdit(index) {
  try {
    const textarea = document.getElementById(`edit-textarea-${index}`);
    if (textarea) {
      musicSequence[index] = textarea.value.trim();
      editingIndex = -1;
      renderMusicList();
      addLog(`M√∫sica ${index + 1} editada com sucesso`, 'success');
    }
  } catch (error) {
    console.error('Erro ao salvar edi√ß√£o:', error);
    addLog('Erro ao salvar edi√ß√£o: ' + error.message, 'error');
  }
}

function cancelEdit() {
  editingIndex = -1;
  renderMusicList();
}

function removeMusic(index) {
  try {
    if (confirm(`Tem certeza que deseja remover a m√∫sica ${index + 1}?`)) {
      musicSequence.splice(index, 1);
      if (editingIndex === index) editingIndex = -1;
      if (editingIndex > index) editingIndex--;
      renderMusicList();
      addLog(`M√∫sica ${index + 1} removida`, 'warning');
    }
  } catch (error) {
    console.error('Erro ao remover m√∫sica:', error);
    addLog('Erro ao remover m√∫sica: ' + error.message, 'error');
  }
}

function moveMusic(from, to) {
  try {
    if (from === to) return;
    const temp = musicSequence[from];
    musicSequence.splice(from, 1);
    musicSequence.splice(to, 0, temp);
    
    // Ajustar √≠ndice de edi√ß√£o se necess√°rio
    if (editingIndex === from) editingIndex = to;
    else if (editingIndex > from && editingIndex <= to) editingIndex--;
    else if (editingIndex < from && editingIndex >= to) editingIndex++;
    
    renderMusicList();
  } catch (error) {
    console.error('Erro ao mover m√∫sica:', error);
    addLog('Erro ao mover m√∫sica: ' + error.message, 'error');
  }
}

function renderMusicList() {
  try {
    const list = document.getElementById("musicList");
    list.innerHTML = "";
    
    if (musicSequence.length === 0) {
      list.innerHTML = '<div style="text-align:center; color:#6c757d; padding:20px;">Nenhuma m√∫sica adicionada ainda</div>';
      return;
    }
    
    musicSequence.forEach((music, i) => {
      const div = document.createElement("div");
      div.className = `music-item ${editingIndex === i ? 'editing' : ''}`;
      div.draggable = editingIndex !== i;
      div.dataset.index = i;

      if (editingIndex !== i) {
        div.addEventListener("dragstart", (e) => { e.dataTransfer.setData("text/plain", i); });
        div.addEventListener("dragover", (e) => { e.preventDefault(); });
        div.addEventListener("drop", (e) => {
          e.preventDefault();
          const from = parseInt(e.dataTransfer.getData("text/plain"));
          const to = parseInt(div.dataset.index);
          moveMusic(from, to);
        });
      }

      const titleDiv = document.createElement("div");
      titleDiv.className = "music-title";
      
      if (editingIndex === i) {
        // Modo de edi√ß√£o
        titleDiv.innerHTML = `
          <strong>Editando M√∫sica ${i + 1}:</strong>
          <div class="edit-form">
            <textarea id="edit-textarea-${i}" placeholder="Cole a letra da m√∫sica aqui...">${music}</textarea>
            <div style="margin-top:10px;">
              <button onclick="saveEdit(${i})">üíæ Salvar</button>
              <button class="secondary" onclick="cancelEdit()">‚ùå Cancelar</button>
            </div>
          </div>
        `;
      } else {
        // Modo de visualiza√ß√£o
        const firstLine = music.split('\n')[0];
        titleDiv.innerHTML = `
          <strong>M√∫sica ${i + 1}:</strong><br>
          <em>${firstLine}</em><br>
          <small style="color:#adb5bd;">${music.split('\n\n').length} estrofe(s)</small>
        `;
      }

      const actionsDiv = document.createElement("div");
      actionsDiv.className = "music-actions";
      
      if (editingIndex !== i) {
        actionsDiv.innerHTML = `
          <div class="edit-btn" onclick="editMusic(${i})">‚úèÔ∏è Editar</div>
          <div class="remove-btn" onclick="removeMusic(${i})">üóëÔ∏è Remover</div>
        `;
      }

      div.appendChild(titleDiv);
      if (editingIndex !== i) {
        div.appendChild(actionsDiv);
      }
      list.appendChild(div);
    });
  } catch (error) {
    console.error('Erro ao renderizar lista:', error);
    addLog('Erro ao renderizar lista: ' + error.message, 'error');
  }
}

function clearAll() {
  try {
    if (confirm("Tem certeza que deseja limpar toda a sequ√™ncia de m√∫sicas?")) {
      musicSequence = [];
      editingIndex = -1;
      renderMusicList();
      document.getElementById("preview").classList.add("hidden");
      addLog("Sequ√™ncia de m√∫sicas limpa", 'warning');
    }
  } catch (error) {
    console.error('Erro ao limpar:', error);
    addLog('Erro ao limpar: ' + error.message, 'error');
  }
}

// Fun√ß√£o simplificada para importar PPTX (placeholder para funcionalidade futura)
async function importPPTX() {
  try {
    addLog('Funcionalidade de importa√ß√£o em desenvolvimento', 'warning');
    showStatusMessage('Funcionalidade de importa√ß√£o PPTX em desenvolvimento. Use a aba "Criar Novo" por enquanto.', 'warning');
  } catch (error) {
    console.error('Erro na importa√ß√£o:', error);
    addLog('Erro na importa√ß√£o: ' + error.message, 'error');
  }
}

function previewSlides() {
  try {
    if (musicSequence.length === 0) {
      alert("Adicione pelo menos uma m√∫sica para visualizar os slides.");
      return;
    }
    
    const previewDiv = document.getElementById("preview");
    const previewContent = document.getElementById("previewContent");
    previewContent.innerHTML = "";
    
    const caseOpt = document.getElementById("caseOption").value;
    let slideCount = 0;
    
    musicSequence.forEach((music, musicIndex) => {
      let processedMusic = music;
      if (caseOpt === "upper") processedMusic = processedMusic.toUpperCase();
      if (caseOpt === "lower") processedMusic = processedMusic.toLowerCase();
      
      const blocks = processedMusic.split(/\n\s*\n/).map(b => b.trim().replace(/\n{2,}/g, "\n"));
      
      blocks.forEach((block, blockIndex) => {
        if (block.trim()) {
          slideCount++;
          const slideDiv = document.createElement("div");
          slideDiv.className = "slide-preview";
          slideDiv.innerHTML = `
            <strong>Slide ${slideCount} - M√∫sica ${musicIndex + 1}, Estrofe ${blockIndex + 1}:</strong>
            <div class="slide-preview-text">${block.replace(/\n/g, '<br>')}</div>
          `;
          previewContent.appendChild(slideDiv);
        }
      });
      
      // Slide separador (exceto na √∫ltima m√∫sica)
      if (musicIndex < musicSequence.length - 1) {
        slideCount++;
        const separatorDiv = document.createElement("div");
        separatorDiv.className = "slide-preview";
        separatorDiv.style.borderLeft = "3px solid #6c757d";
        separatorDiv.innerHTML = `<strong>Slide ${slideCount}:</strong> <em>(Slide vazio - separador)</em>`;
        previewContent.appendChild(separatorDiv);
      }
    });
    
    previewDiv.classList.remove("hidden");
    addLog(`Pr√©-visualiza√ß√£o gerada com ${slideCount} slides`, 'info');
  } catch (error) {
    console.error('Erro na pr√©-visualiza√ß√£o:', error);
    addLog('Erro na pr√©-visualiza√ß√£o: ' + error.message, 'error');
  }
}

// Fun√ß√£o para medir texto
function measureText(text, fontSize, fontFamily = 'Arial') {
  try {
    const measurer = document.getElementById('textMeasure');
    measurer.style.fontSize = fontSize + 'px';
    measurer.style.fontFamily = fontFamily;
    measurer.style.lineHeight = '1.2';
    measurer.textContent = text;
    
    return {
      width: measurer.offsetWidth,
      height: measurer.offsetHeight
    };
  } catch (error) {
    console.error('Erro ao medir texto:', error);
    return { width: 0, height: 0 };
  }
}

// Fun√ß√£o para calcular dimens√µes do slide baseado no layout
function getSlideConstraints(layout) {
  const layouts = {
    'LAYOUT_16x9': { width: 960, height: 540 },
    'LAYOUT_4x3': { width: 720, height: 540 }
  };
  
  const base = layouts[layout] || layouts['LAYOUT_16x9'];
  return {
    width: base.width * 0.8,
    height: base.height * 0.8
  };
}

// Fun√ß√£o de log
function addLog(message, type = 'info') {
  try {
    const logDiv = document.getElementById('log');
    const logContent = document.getElementById('logContent');
    
    const logItem = document.createElement('div');
    logItem.className = `log-item log-${type}`;
    logItem.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
    
    logContent.appendChild(logItem);
    logDiv.classList.remove('hidden');
    logContent.scrollTop = logContent.scrollHeight;
  } catch (error) {
    console.error('Erro no log:', error);
  }
}

// Fun√ß√£o principal de gera√ß√£o (simplificada)
async function generatePPTX() {
  try {
    if(musicSequence.length === 0) {
      alert("Adicione pelo menos uma m√∫sica √† sequ√™ncia.");
      return;
    }

    if (editingIndex !== -1) {
      alert("Finalize a edi√ß√£o da m√∫sica atual antes de gerar o arquivo.");
      return;
    }

    // Verificar se PptxGenJS est√° dispon√≠vel
    if (typeof PptxGenJS === 'undefined') {
      addLog('Erro: Biblioteca PptxGenJS n√£o est√° carregada', 'error');
      showStatusMessage('Erro: N√£o foi poss√≠vel carregar a biblioteca necess√°ria. Recarregue a p√°gina.', 'error');
      return;
    }

    const progressDiv = document.getElementById('progress');
    const progressBar = document.getElementById('progressBar');
    const logContent = document.getElementById('logContent');
    
    logContent.innerHTML = '';
    progressDiv.classList.remove('hidden');
    
    addLog('Iniciando gera√ß√£o do PowerPoint...', 'success');

    const pptx = new PptxGenJS();
    const layout = document.getElementById("layout").value;
    pptx.layout = layout;
    
    const textColor = document.getElementById("textColor").value;
    const bgColor = document.getElementById("bgColor").value;
    const initialFontSize = parseInt(document.getElementById("fontSize").value);
    const align = document.getElementById("align").value;
    const caseOpt = document.getElementById("caseOption").value;
    
    const fontFamily = document.getElementById("fontFamily").value;
    const selectedEffects = Array.from(document.getElementById("fontEffects").selectedOptions).map(option => option.value);
    const isBold = selectedEffects.includes('bold');
    const isItalic = selectedEffects.includes('italic');

    addLog(`Configura√ß√µes: Layout ${layout}, Fonte ${fontFamily} ${initialFontSize}px`, 'info');

    let slideCount = 0;
    
    for (let musicIndex = 0; musicIndex < musicSequence.length; musicIndex++) {
      let music = musicSequence[musicIndex];
      
      if(caseOpt === "upper") music = music.toUpperCase();
      if(caseOpt === "lower") music = music.toLowerCase();
      
      let blocks = music.split(/\n\s*\n/).map(b => b.trim().replace(/\n{2,}/g, "\n"));
      
      addLog(`Processando m√∫sica ${musicIndex + 1} com ${blocks.length} estrofe(s)`, 'info');
      
      for (let blockIndex = 0; blockIndex < blocks.length; blockIndex++) {
        let block = blocks[blockIndex];
        if (!block.trim()) continue;
        
        const slide = pptx.addSlide();
        slide.background = { color: bgColor };
        
        slide.addText(block, {
          x: 0.5, 
          y: 0.5, 
          w: "90%", 
          h: "90%",
          fontSize: initialFontSize,
          fontFace: fontFamily,
          bold: isBold,
          italic: isItalic,
          color: textColor,
          align: align,
          valign: "middle",
          margin: 0.3
        });
        
        slideCount++;
      }
      
      // Slide separador (exceto na √∫ltima m√∫sica)
      if (musicIndex < musicSequence.length - 1) {
        const separatorSlide = pptx.addSlide();
        separatorSlide.background = { color: bgColor };
        slideCount++;
      }
      
      progressBar.style.width = ((musicIndex + 1) / musicSequence.length * 90) + '%';
      await new Promise(resolve => setTimeout(resolve, 100));
    }

    addLog(`Total de ${slideCount} slides criados`, 'success');
    progressBar.style.width = '100%';
    addLog('PowerPoint gerado com sucesso!', 'success');
    
    await pptx.writeFile({ fileName: "sequencia_musicas.pptx" });
    addLog('Arquivo baixado com sucesso!', 'success');
    showStatusMessage('Arquivo PowerPoint gerado e baixado com sucesso!', 'success');
    
  } catch (error) {
    console.error('Erro na gera√ß√£o:', error);
    addLog('Erro ao gerar arquivo: ' + error.message, 'error');
    showStatusMessage('Erro ao gerar arquivo: ' + error.message, 'error');
  }
  
  setTimeout(() => {
    progressDiv.classList.add('hidden');
  }, 3000);
}
</script>
</body>
</html>